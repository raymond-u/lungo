{% set NGINX_VER = '1.21.4.2-alpine-apk' %}

FROM docker.io/openresty/openresty:{{ NGINX_VER }}
RUN adduser -D -H -S www-data && \
    apk --update add logrotate && \
    printf '%s\n' >/etc/periodic/daily/logrotate \
    '#!/bin/sh' \
    'if [ -f /etc/conf.d/logrotate ]; then' \
    '    . /etc/conf.d/logrotate' \
    'fi' \
    'logrotate /etc/logrotate.d/nginx' && \
    chmod +x /etc/periodic/daily/logrotate
