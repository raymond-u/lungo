{% set network = config.network %}
{% set smtp = config.smtp %}

dsn: 'sqlite:///var/lib/kratos/db.sqlite3?_fk=true&mode=rwc'

serve:
  public:
    port: 80
    base_url: 'https://{{ network.hostname }}/'
  admin:
    port: 8080

session:
  cookie:
    name: 'lungo_session'
  earliest_possible_extend: 12h
  lifespan: 24h
  whoami:
    required_aal: aal1

identity:
  default_schema_id: user
  schemas:
    - id: user
      url: 'file:///etc/kratos/user.schema.json'

selfservice:
  default_browser_return_url: 'https://{{ network.hostname }}/'
  flows:
    registration:
      enabled: false
    verification:
      enabled: false
    recovery:
      enabled: true
      use: code
      notify_unknown_recipients: false
      after:
        hooks:
          - hook: revoke_active_sessions
  methods:
    code:
      enabled: true
    password:
      enabled: true
    profile:
      enabled: false

courier:
  smtp:
    connection_uri: 'smtp://{{ smtp.username|urlencode }}:{{ smtp.password }}@{{ smtp.host }}:{{ smtp.port }}/'
    from_address: '{{ smtp.sender }}'
    from_name: '{{ smtp.name }}'
  templates:
    recovery_code:
      valid:
        email:
          subject: /etc/kratos/email_templates/recovery_code/valid/email.subject.gotmpl
          body:
            html: /etc/kratos/email_templates/recovery_code/valid/email.body.gotmpl
            plaintext: /etc/kratos/email_templates/recovery_code/valid/email.body.plaintext.gotmpl
