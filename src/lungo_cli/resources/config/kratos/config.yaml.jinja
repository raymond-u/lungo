{% set network = config.network %}
{% set smtp = config.smtp %}

dsn: 'sqlite:///var/lib/kratos/db.sqlite3?_fk=true&mode=rwc'

serve:
  public:
    port: 80
    base_url: 'https://{{ network.hostname }}/'
  admin:
    port: 8080

session:
  cookie:
    name: 'lungo_session'
  earliest_possible_extend: 12h
  lifespan: 24h
  whoami:
    required_aal: aal1

identity:
  default_schema_id: user
  schemas:
    - id: user
      url: 'file:///etc/kratos/user.schema.json'

selfservice:
  default_browser_return_url: 'https://{{ network.hostname }}/'
  flows:
    registration:
      enabled: false
    verification:
      enabled: false
    recovery:
      enabled: true
      use: link
      notify_unknown_recipients: false
      after:
        hooks:
          - hook: revoke_active_sessions
  methods:
    link:
      enabled: true
      config:
        base_url: 'https://{{ network.hostname }}/recover/'
    password:
      enabled: true
    profile:
      enabled: false

courier:
  smtp:
    connection_uri: 'smtp://{{ smtp.username|urlencode }}:{{ smtp.password }}@{{ smtp.host }}:{{ smtp.port }}/'
    from_address: '{{ smtp.sender }}'
    from_name: '{{ smtp.name }}'
  template_override_path: '/etc/kratos/email_templates'
