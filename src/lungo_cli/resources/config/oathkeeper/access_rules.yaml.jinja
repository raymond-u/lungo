{% set network = config.network %}

- id: app
  match:
    url: 'https://{{ network.hostname }}/app/<(?!filebrowser/(?:api/public|share|static))[^/]*><.*>'
    methods:
      - GET
      - POST
      - DELETE
      - PATCH
      - PUT
      - HEAD
      - OPTIONS
  authenticators:
    - handler: cookie_session
    - handler: anonymous
  authorizer:
    handler: remote_json
  mutators:
    - handler: header
  errors:
    - handler: json

- id: public
  match:
    url: 'https://{{ network.hostname }}/app/filebrowser/<(?:api/public|share|static)>/<.*>'
    methods:
      - GET
      - POST
      - DELETE
      - PATCH
      - PUT
      - HEAD
      - OPTIONS
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop
  errors:
    - handler: json

- id: catch-all
  match:
    url: 'https://{{ network.hostname }}/<(?!app/).*>'
    methods:
      - GET
      - POST
      - DELETE
      - PATCH
      - PUT
      - HEAD
      - OPTIONS
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop
  errors:
    - handler: json
