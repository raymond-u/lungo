import{s as m,f as h,n as l}from"../chunks/scheduler.63274e7e.js";import{S as p,i as f,g as y,z as _,h as k,y as w,f as c,k as v,x,A as b}from"../chunks/index.0765c294.js";function E(i){let e,n="",t,a,s;return{c(){e=y("script"),e.innerHTML=n,this.h()},l(o){const r=_("svelte-156y4tr",document.head);e=k(r,"SCRIPT",{src:!0,"data-svelte-h":!0}),w(e)!=="svelte-g2t9yy"&&(e.innerHTML=n),r.forEach(c),this.h()},h(){h(e.src,t="/rstudio/js/encrypt.min.js")||v(e,"src",t)},m(o,r){x(document.head,e),a||(s=b(e,"load",i[0]),a=!0)},p:l,i:l,o:l,d(o){c(e),a=!1,s()}}}function S(i){return[async()=>{const n=()=>{console.log("Redirecting to RStudio..."),window.location.href="/rstudio/"};try{console.log("Checking if user is already logged in...");let t=await fetch("/rstudio/",{credentials:"include",redirect:"manual"});if(t.ok||(console.log("User is not logged in, attempting to log in..."),t=await fetch("/rstudio/auth-sign-in",{credentials:"include",redirect:"manual"}),!t.ok))return n();let a=await t.text();const s=new DOMParser().parseFromString(a,"text/html"),o=s.getElementsByName("public-key-url")[0].getAttribute("content");if(console.log("Fetching public key..."),t=await fetch(`/rstudio/${o}`,{credentials:"include"}),!t.ok)return n();a=await t.text();const d=`${t.headers.get("Remote-User")}
passwd`,[u,g]=a.split(":",2);s.getElementById("clientPath").value="/rstudio/auth-sign-in",s.getElementById("package").value=encrypt(d,u,g),s.getElementById("persist").value="0",console.log("Submitting login form..."),s.getElementsByName("realform")[0].submit()}finally{n()}}]}class I extends p{constructor(e){super(),f(this,e,S,E,m,{})}}export{I as component};
