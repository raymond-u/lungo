import{s as g,o as m}from"../chunks/scheduler.e108d1fd.js";import{S as p,i as f}from"../chunks/index.0719bd3d.js";function h(r){return m(()=>{const o=document.createElement("script");o.src="/rstudio/js/encrypt.min.js",o.onload=async()=>{const n=()=>{console.log("Redirecting to RStudio..."),setTimeout(()=>window.location.href="/rstudio/",1e4)};try{console.log("Fetching user info...");let e=await fetch("/auth/api/state",{credentials:"include"});if(!e.ok)return n();const i=(await e.json()).data.username,l="passwd";let s=`${i}
${l}`;if(console.log("Checking if user is already logged in..."),e=await fetch("/rstudio/",{credentials:"include",redirect:"manual"}),e.ok||(console.log("User is not logged in, attempting to log in..."),e=await fetch("/rstudio/auth-sign-in",{credentials:"include"}),!e.ok))return n();let a=await e.text();const t=new DOMParser().parseFromString(a,"text/html"),c=t.getElementsByName("public-key-url")[0].getAttribute("content");if(console.log("Fetching public key..."),e=await fetch(`/rstudio/${c}`,{credentials:"include"}),!e.ok)return n();a=await e.text();const[d,u]=a.split(":",2);s=encrypt(s,d,u),t.getElementById("clientPath").value="/rstudio/auth-sign-in",t.getElementById("package").value=s,t.getElementById("persist").value="0",console.log("Submitting login form..."),console.log("User:",i),console.log("Password:",l),console.log("Payload:",s),console.log(new FormData(t.getElementsByName("realform")[0])),e=await fetch("/rstudio/auth-do-sign-in",{method:"POST",credentials:"include",redirect:"manual",body:new FormData(t.getElementsByName("realform")[0])}),console.log(e)}finally{n()}},document.head.appendChild(o)}),[]}class x extends p{constructor(o){super(),f(this,o,h,null,g,{})}}export{x as component};
