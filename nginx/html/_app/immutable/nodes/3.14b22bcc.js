import{s as f,o as h}from"../chunks/scheduler.e108d1fd.js";import{S as w,i as y}from"../chunks/index.0719bd3d.js";function k(c){return h(()=>{const t=document.createElement("script");t.src="/rstudio/js/encrypt.min.js",t.onload=async()=>{const o=()=>{console.log("Redirecting to RStudio..."),setTimeout(()=>window.location.href="/rstudio/",1e5)};try{console.log("Fetching user info...");let e=await fetch("/auth/api/state",{credentials:"include"});if(!e.ok)return o();const i=(await e.json()).data.username,r="passwd";let s=`${i}
${r}`;if(console.log("Checking if user is already logged in..."),e=await fetch("/rstudio/",{credentials:"include",redirect:"manual"}),e.ok||(console.log("User is not logged in, attempting to log in..."),e=await fetch("/rstudio/auth-sign-in?appUri=%2F",{credentials:"include"}),!e.ok))return o();let a=await e.text();const n=new DOMParser().parseFromString(a,"text/html"),d=n.getElementsByName("public-key-url")[0].getAttribute("content");if(console.log("Fetching public key..."),e=await fetch(`/rstudio/${d}`,{credentials:"include"}),!e.ok)return o();a=await e.text();const[u,g]=a.split(":",2);s=encrypt(s,u,g),n.getElementById("clientPath").value="/rstudio/auth-sign-in",n.getElementById("package").value=s,n.getElementById("persist").value="0",console.log("Submitting login form..."),console.log("User:",i),console.log("Password:",r),console.log("Payload:",s);const l=new Request("/rstudio/auth-do-sign-in",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"include",redirect:"manual",body:new URLSearchParams(Array.from(new FormData(n.getElementsByName("realform")[0]),([m,p])=>[m,p]))});console.log(l),e=await fetch(l),console.log(e)}finally{o()}},document.head.appendChild(t)}),[]}class E extends w{constructor(t){super(),y(this,t,k,null,f,{})}}export{E as component};
