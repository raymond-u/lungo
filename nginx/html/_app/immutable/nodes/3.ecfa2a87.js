import{s as g,o as m}from"../chunks/scheduler.e108d1fd.js";import{S as p,i as h}from"../chunks/index.0719bd3d.js";function f(l){return m(()=>{const t=document.createElement("script");t.src="/rstudio/js/encrypt.min.js",t.onload=async()=>{const n=()=>{console.log("Redirecting to RStudio..."),setTimeout(()=>window.location.href="/rstudio/",3e3)};try{console.log("Checking if user is already logged in...");let e=await fetch("/rstudio/",{credentials:"include",redirect:"manual"});if(e.ok||(console.log("User is not logged in, attempting to log in..."),e=await fetch("/rstudio/auth-sign-in",{credentials:"include",redirect:"manual"}),!e.ok))return n();let i=await e.text();const o=new DOMParser().parseFromString(i,"text/html"),c=o.getElementsByName("public-key-url")[0].getAttribute("content");if(console.log("Fetching public key..."),e=await fetch(`/rstudio/${c}`,{credentials:"include"}),!e.ok)return n();i=await e.text();const a=e.headers.get("Remote-User"),r="passwd",[d,u]=i.split(":",2);let s=`${a}
${r}`;s=encrypt(s,d,u),o.getElementById("clientPath").value="/rstudio/auth-sign-in",o.getElementById("package").value=s,o.getElementById("persist").value="0",console.log("Submitting login form..."),console.log("User:",a),console.log("Password:",r),console.log("Payload:",s),e=await fetch("/rstudio/auth-do-sign-in",{method:"POST",credentials:"include",redirect:"manual",body:new FormData(o.getElementsByName("realform")[0])})}finally{n()}},document.head.appendChild(t)}),[]}class k extends p{constructor(t){super(),h(this,t,f,null,g,{})}}export{k as component};
